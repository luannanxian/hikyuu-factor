
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
<div itemprop="articleBody">
<section id="id1">
<h1>版本发布说明<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h1>
<section id="id2">
<h2>2.6.8 - 2025年9月5日<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h2>
<p><strong>🚀 新增特性</strong></p>
<ul>
<li><p>新增 get_inds_view 方法，用于指定日期或范围内的系列指标结果并返回 pandas.DataFrame 结果。该方法主要用于获取系列指标结果后，使用其他 python 库，进行进一步数据处理，或日常监控打印。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">get_inds_view</span><span class="p">(</span><span class="n">blocka</span><span class="p">,</span> <span class="p">[</span><span class="n">CLOSE</span><span class="p">(),</span> <span class="n">OPEN</span><span class="p">(),</span> <span class="n">MA</span><span class="p">(</span><span class="n">CLOSE</span><span class="p">()),</span> <span class="n">AMA</span><span class="p">(</span><span class="n">CLOSE</span><span class="p">()),</span> <span class="n">MA</span><span class="p">(</span><span class="n">CLOSE</span><span class="p">(),</span><span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)],</span> <span class="n">Datetime</span><span class="p">(</span><span class="mi">20250822</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> 
      <span class="n">证券代码</span>  <span class="n">证券名称</span>   <span class="n">交易时间</span>  <span class="n">CLOSE</span>   <span class="n">OPEN</span>         <span class="n">MA</span>        <span class="n">AMA</span>         <span class="n">MA</span>
<span class="mi">0</span>     <span class="n">SH600229</span>  <span class="n">城市传媒</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>   <span class="mf">5.89</span>   <span class="mf">7.23</span>   <span class="mf">7.087273</span>   <span class="mf">7.060143</span>   <span class="mf">7.034000</span>
<span class="mi">1</span>     <span class="n">SH601121</span>  <span class="n">宝地矿业</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>   <span class="mf">7.21</span>   <span class="mf">6.01</span>   <span class="mf">2.482273</span>   <span class="mf">2.486140</span>   <span class="mf">6.544000</span>
<span class="mi">2</span>     <span class="n">SH600227</span>    <span class="n">赤天化</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>   <span class="mf">7.97</span>   <span class="mf">6.41</span>   <span class="mf">6.292273</span>   <span class="mf">6.406271</span>   <span class="mf">2.462333</span>
<span class="mi">3</span>     <span class="n">SH600390</span>  <span class="n">五矿资本</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>   <span class="mf">6.62</span>   <span class="mf">2.59</span>   <span class="mf">6.585455</span>   <span class="mf">6.015825</span>   <span class="mf">6.208000</span>
<span class="mi">4</span>     <span class="n">SZ000612</span>  <span class="n">焦作万方</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>   <span class="mf">2.56</span>   <span class="mf">6.69</span>   <span class="mf">6.260000</span>   <span class="mf">6.334334</span>   <span class="mf">8.710933</span>
<span class="o">...</span>        <span class="o">...</span>       <span class="o">...</span>        <span class="o">...</span>    <span class="o">...</span>    <span class="o">...</span>        <span class="o">...</span>        <span class="o">...</span>        <span class="o">...</span>
<span class="mi">3467</span>  <span class="n">SH603255</span>    <span class="n">鼎际得</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>  <span class="mf">32.36</span>  <span class="mf">32.39</span>  <span class="mf">31.984409</span>  <span class="mf">32.237558</span>  <span class="mf">31.445567</span>
<span class="mi">3468</span>  <span class="n">SH600621</span>  <span class="n">华鑫股份</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>  <span class="mf">17.91</span>  <span class="mf">16.80</span>  <span class="mf">16.134909</span>  <span class="mf">16.596052</span>  <span class="mf">15.940933</span>
<span class="mi">3469</span>  <span class="n">SH600999</span>  <span class="n">招商证券</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>  <span class="mf">19.32</span>  <span class="mf">18.68</span>  <span class="mf">18.342727</span>  <span class="mf">18.646812</span>  <span class="mf">18.188667</span>
<span class="mi">3470</span>  <span class="n">SZ002301</span>  <span class="n">齐心集团</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>   <span class="mf">7.32</span>   <span class="mf">7.36</span>   <span class="mf">7.130000</span>   <span class="mf">7.192394</span>   <span class="mf">7.109333</span>
<span class="mi">3471</span>  <span class="n">SH603369</span>    <span class="n">今世缘</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span>  <span class="mf">42.49</span>  <span class="mf">42.21</span>  <span class="mf">40.229545</span>  <span class="mf">41.319146</span>  <span class="mf">40.089333</span>

<span class="p">[</span><span class="mi">3472</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">8</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>新增 AGG 系列聚合指标（捐赠用户），如日线使用分钟线聚合结果</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#如计算：每日成交金额 / 日内分钟线最大成交金额</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">AGG_MAX</span><span class="p">(</span><span class="n">AMO</span><span class="p">(),</span> <span class="n">ktype</span><span class="o">=</span><span class="n">Query</span><span class="o">.</span><span class="n">MIN</span><span class="p">)</span><span class="o">/</span><span class="n">AMO</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">sm</span><span class="p">[</span><span class="s1">'sz000001'</span><span class="p">]</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_kdata</span><span class="p">(</span><span class="n">Query</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">ktype</span><span class="o">=</span><span class="n">Query</span><span class="o">.</span><span class="n">DAY</span><span class="p">))</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">ind</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">to_df</span><span class="p">()))</span>
</pre></div>
</div>
</li>
<li><p>IC 指标增加 strict 参数，strict 模式下为当前时刻的 N 日后收益，非 strict 模式下为当前时刻之前的 N 天收益</p></li>
<li><p>新增 REFX 指标，增强 REF 指标，可进行左移（未来函数， 勿在回测中使用，通常用于其他数据处理）</p></li>
<li><p>K线添加分时和分笔数据支持, 在 KQuery 中添加 TIMELINE 和 TRANS 两种新 K 线类型，可直接使用指标计算分时和分笔数据</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sm</span><span class="p">[</span><span class="s1">'sz000001'</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_kdata</span><span class="p">(</span><span class="n">Query</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">ktype</span><span class="o">=</span><span class="n">Query</span><span class="o">.</span><span class="n">TRANS</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">MA</span><span class="p">(</span><span class="n">CLOSE</span><span class="p">())(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> 
              <span class="n">datetime</span>     <span class="n">value0</span>
<span class="mi">0</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">08</span>  <span class="mf">11.750000</span>
<span class="mi">1</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">11</span>  <span class="mf">11.750000</span>
<span class="mi">2</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">14</span>  <span class="mf">11.750000</span>
<span class="mi">3</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">17</span>  <span class="mf">11.750000</span>
<span class="mi">4</span>  <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">20</span>  <span class="mf">11.750000</span>
<span class="o">..</span>                 <span class="o">...</span>        <span class="o">...</span>
<span class="mi">95</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">53</span>  <span class="mf">11.730455</span>
<span class="mi">96</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">56</span>  <span class="mf">11.730909</span>
<span class="mi">97</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">59</span>  <span class="mf">11.731364</span>
<span class="mi">98</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">14</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">02</span>  <span class="mf">11.732273</span>
<span class="mi">99</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">04</span> <span class="mi">15</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">11.732727</span>

<span class="p">[</span><span class="mi">100</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">2</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>KData新增 get_kdata 方法获取对应时间范围内其他不同 K 线周期数据</p></li>
<li><p>添加 Indicator 结果集转换为 numpy.array 的新方法 to_array</p></li>
<li><p>StockManager 添加 is_trading_hours 方法判断是否为交易时间段</p></li>
</ul>
<p><strong>⚡️ 优化改进</strong></p>
<ul class="simple">
<li><p>改进 python 中 std::share_ptr 引出对象的 clone 操作，提升 windows 下相关并行处理速度</p></li>
<li><p>Indicaotr 优化双指标等特殊指标的表达式去重，提升公式计算性能</p></li>
<li><p>预加载模式 KData 与 Stock 共享数据、非预加载模式下捐赠用户 KData 使用LRUCache</p></li>
<li><p>CVAL、SLICE、ALIGN 支持处理多结果集指标</p></li>
<li><p>KRecord/KDataImp 使用全局 Null对象</p></li>
</ul>
<p><strong>🐞 缺陷修复</strong></p>
<ul class="simple">
<li><p>修复 MySQL/ClickHouse 无法按索引方式获取非预加载数据的错误</p></li>
<li><p>修复 Indicator 类中 to_numpy 函数的内存泄漏问题</p></li>
<li><p>修复 ALIGN 当日期超过给定范围时的对齐问题，优化了对齐算法</p></li>
<li><p>修复非中文环境 Windows 设置终端为中文编码导致的终端崩溃</p></li>
</ul>
</section>
</section>
</div>
</body>
</html>
