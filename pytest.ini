[tool:pytest]
# A股量化因子系统 - pytest配置文件
# 配置测试发现、标记、输出格式和覆盖率设置

# ==============================================================================
# 基础测试发现配置
# ==============================================================================

# 测试文件搜索路径
testpaths = tests

# Python测试文件匹配模式
python_files = test_*.py *_test.py

# Python测试函数匹配模式
python_functions = test_*

# Python测试类匹配模式
python_classes = Test*

# ==============================================================================
# 命令行选项和行为配置
# ==============================================================================

# 默认命令行参数
addopts =
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --durations=10
    --color=yes
    --disable-warnings

# 最小pytest版本要求
minversion = 7.0

# ==============================================================================
# 测试标记定义 (Test Markers)
# ==============================================================================

markers =
    # 基础测试类型标记
    unit: Unit tests - 单元测试，测试单个函数或类的功能
    integration: Integration tests - 集成测试，测试组件间的交互
    contract: Contract tests - 契约测试，验证API接口规范
    performance: Performance tests - 性能测试，验证系统性能指标

    # 执行时间标记
    slow: Slow running tests - 执行时间较长的测试（>5秒）
    fast: Fast running tests - 快速执行的测试（<1秒）

    # 依赖环境标记
    requires_hikyuu: Tests requiring Hikyuu framework - 需要Hikyuu框架的测试
    requires_mysql: Tests requiring MySQL database - 需要MySQL数据库的测试
    requires_redis: Tests requiring Redis cache - 需要Redis缓存的测试
    requires_network: Tests requiring network access - 需要网络访问的测试

    # Agent特定标记
    data_agent: Tests for DataManager Agent - 数据管理Agent相关测试
    factor_agent: Tests for FactorCalculation Agent - 因子计算Agent相关测试
    validation_agent: Tests for Validation Agent - 验证Agent相关测试
    signal_agent: Tests for SignalGeneration Agent - 信号生成Agent相关测试

    # 平台特定标记
    apple_silicon: Tests specific to Apple Silicon platform - Apple Silicon平台特定测试
    x86_64: Tests specific to x86_64 platform - x86_64平台特定测试
    linux_only: Tests that only run on Linux - 仅在Linux上运行的测试
    macos_only: Tests that only run on macOS - 仅在macOS上运行的测试

    # 数据和环境标记
    with_real_data: Tests using real market data - 使用真实市场数据的测试
    with_mock_data: Tests using mock/synthetic data - 使用模拟数据的测试
    requires_large_memory: Tests requiring large memory allocation - 需要大内存的测试

    # 安全和合规标记
    security: Security-related tests - 安全相关测试
    audit: Audit trail and compliance tests - 审计和合规测试

    # 开发和调试标记
    wip: Work in progress tests - 开发中的测试（可能不稳定）
    debug: Debug tests - 调试用测试
    experimental: Experimental features tests - 实验性功能测试

# ==============================================================================
# 测试输出和日志配置
# ==============================================================================

# 日志相关配置
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# 捕获标准输出
capture = no

# ==============================================================================
# 过滤和忽略配置
# ==============================================================================

# 忽略的警告类型
filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning:hikyuu.*
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning

# 忽略的文件和目录
norecursedirs =
    .git
    .tox
    dist
    build
    *.egg
    __pycache__
    .pytest_cache
    node_modules

# ==============================================================================
# 并发和性能配置
# ==============================================================================

# 测试超时设置（秒）
timeout = 300

# 并发测试进程数（如果安装了pytest-xdist）
# addopts = -n auto

# ==============================================================================
# 自定义配置选项
# ==============================================================================

# 自定义ini选项（补充配置）
# addopts配置已在上方定义，这里仅作说明
# 可以添加的其他选项：
# --maxfail=5  # 最多失败5个测试后停止
# --ff         # 优先运行上次失败的测试

# JUnit XML报告（用于CI/CD）
# addopts = --junitxml=test-results.xml

# HTML报告（如果安装了pytest-html）
# addopts = --html=reports/report.html --self-contained-html